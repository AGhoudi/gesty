{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} - Liste de tâches{% endblock %}

{% block header %}
    <div class="header-content clearfix">
        <a class="logo" href="{{ path('home') }}">GESTY</a>
        <nav class="navigation" role="navigation">
            <ul class="primary-nav">
                <li><a href="{{ path('home') }}">Accueil</a></li>
                <li><a href="{{ path('member') }}">Espace membre</a></li>
                <li><a  class="espace" href=""><i class="fas fa-user vert"></i>{{ app.user.username }}</a></li>
                <li><a class="deconnect" href="{{ path('logout') }}"><i class="fas fa-user rouge"></i>Se déconnecter</a></li>
            </ul>
        </nav>
        <a href="#" class="nav-toggle">Menu<span></span></a>
    </div><!-- header content -->
{% endblock %}

{% block body %}
    <div class="container d-flex justify-content-center" style="margin-top: 200px; width: 100%;">
    <h2  class="text-white text-center my-5" >L'outil liste de tâches vous permettra de mettre en place une liste <br> de tâches à accomplir</h2>
</div>
    <div class="container" style="margin-top: 350px; width: 100%;">
        <img src="{{ asset('build/images/checklist.jpg') }}" class="img-thumbnail" alt="" style="max-height: 500px;min-width: 100%;">
    </div>
    <div class="container my-3">
        <p class="d-flex justify-content-center"><a type="button" class="btn btn-danger d-flex justify-content-center text-center bn_membre" href="{{ path('member') }}">
                <i class="fas fa-chevron-circle-left  mr-2 mt-1"></i> Retourner à l'espace membre
            </a>
        </p>
    </div>
    <div class="container d-flex justify-content-center">
        <h3 style="font-family: 'Lobster', cursive; color: #e84545;">Ma liste de tâches</h3>
    </div>
    <div class="container d-flex justify-content-center my-2">
        {{ form_start(todoForm) }}

        {{ form_widget(todoForm.list, {'attr': {'placeholder': 'Ajouter une tâche'}}) }}

        <span class="container d-flex justify-content-center">
            {{ form_widget(todoForm.submit, { 'label': 'Ajouter une tâche' , 'attr': {'class': 'add_todo'}}) }}
        </span>

        {{ form_end(todoForm) }}
    </div>

    <ul  class="container my-3 liste">

        {% for todo in listTodo %}

            <li class=" my-2 font-weight-bold text-center">

                {% if todo.checked == true %}
                    <div class="d-flex flex-row justify-content-center">
                        <input type="checkbox" class="mt-3 mr-2" value="{{ todo.id }}" checked/>
                        <h4  class="text-center titre mt-1" style="text-decoration: line-through;">{{ todo.list }}</h4>
                    </div>

                {% else %}
                    <div class="d-flex flex-row justify-content-center">
                        <input type="checkbox" class="mt-3 mr-2" value="{{ todo.id }}"/>
                        <h4  class="text-center titre mt-1">{{ todo.list }}</h4>
                    </div>

                {% endif %}

                <div class="lien" >

                    <a type="button" class="btn d-flex justify-content-center my-2" >
                        <i class="fas fa-edit  mr-1 mt-1"></i>modifier
                    </a>

                    <a type="button" class="btn d-flex justify-content-center text-center my-2 delete" id="{{ todo.id }}">
                        <i class="fas fa-window-close  mr-2 mt-1"></i> supprimer
                    </a><br>

                </div>

                <div class="result my-2">

                    <div class="alert alert-success modify_todo" role="alert" style="height: auto;">
                        <h5 class="modify_title">Modifier ma tâche</h5>
                        <input type="text" class="form-control">
                        <button class="btn btn-success mt-2 mod_button" id="{{ todo.id }}">Modifier</button>
                    </div>

                </div>

            </li>

        {% endfor %}

    </ul>

    {% set maxValue = 0 %}

    {% for todo in listAllTodo %}
        {% set maxValue = max(todo.id, maxValue) + 1 %}
    {% endfor %}

    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous">
    </script>

    <style>
        .highlight {
            text-decoration: line-through;
            color: #fb6a4c;
        }
    </style>

    <script>
        $( document ).ready(function() {

            $("button#todo_submit").click(function() {

                const add = $( "input#todo_list" ).val();

                $("ul.container.my-3.liste").append("<li class=\" my-2 font-weight-bold text-center\">\n" +
                    "\n" +
                    "        \n" +
                    "            <div class=\"d-flex flex-row justify-content-center\">\n" +
                    "                <input type=\"checkbox\" class=\"mt-4 mr-2\" value=\"{{ maxValue }}\">\n" +
                    "                <h4  class=\"text-center titre\">" + add + "</h4>\n" +
                    "            </div>\n" +
                    "\n" +
                    "        \n" +
                    "\n" +
                    "        <div class=\"lien\" >\n" +
                    "\n" +
                    "            <a type=\"button\" class=\"btn btn-success d-flex justify-content-center my-2\" >\n" +
                    "                <i class=\"fas fa-edit  mr-1 mt-1\"></i>modifier\n" +
                    "            </a>\n" +
                    "\n" +
                    "            <a type=\"button\" class=\"btn btn-danger d-flex justify-content-center text-center my-2 delete\" id=\"{{ maxValue }}\">\n" +
                    "                \n" +
                    "                <i class=\"fas fa-window-close  mr-2 mt-1\"></i> supprimer\n" +
                    "            </a><br>\n" +
                    "\n" +
                    "        </div>\n" +
                    "\n" +
                    "        <div class=\"result\">\n" +
                    "\n" +
                    "            <div class=\"alert alert-success\" role=\"alert\" style=\"height: auto;\">\n" +
                    "                <h5>Modifier ma tâche</h5>\n" +
                    "                <input type=\"text\" class=\"form-control\">\n" +
                    "                <button class=\"btn btn-success mt-2\" id=\"{{ maxValue }}\" >Modifier</button>\n" +
                    "            </div>\n" +
                    "\n" +
                    "        </div>\n" +
                    "\n" +
                    "    </li>");

                $("div.result").hide();
                $.ajax({
                    url: "{{ (path('todo')) }}",
                    type: "POST",
                    dataType: "json",
                    data: {
                        "addAjax": add
                    },
                    async: true,
                    success: function (data)
                    {

                    }

                });
                return false;
            });
        });
    </script>

    <script>

        $( document ).ready(function() {

            $("div.result").hide();

            $(document).on("click","a.btn.d-flex.justify-content-center.my-2",function() {
                $(this).parent().next().toggle();
            });

            $(document).on("click","button.btn.btn-success.mt-2",function() {

                const modify = $(this).prev("input.form-control").val();
                const modifyId = $(this).attr('id');

                if (modify ===  ""){
                    //Do nothing
                }
                else {
                    $(this).parent().parent().parent().find("h4.text-center.titre").html($(this).prev("input.form-control").val());
                }

                $.ajax({
                    url: "{{ (path('todo')) }}",
                    type: "POST",
                    dataType: "json",
                    data: {
                        "modifyAjax": modify,
                        "modifyAjaxId": modifyId
                    },
                    async: true,
                    success: function (data) {

                    }

                });

            });

        });

    </script>

    <script>
        $( document ).ready(function() {

            $(document).on("click","a.btn.d-flex.justify-content-center.text-center.my-2.delete",function() {
                const confirmation = confirm('Êtes vous sur de vouloir supprimer cet élément ?');
                if(confirmation){

                    const suppress = $( this ).attr('id');


                    $.ajax({
                        url:'{{ (path('todo')) }}',
                        type: "POST",
                        dataType: "json",
                        data: {
                            "suppressAjax": suppress
                        },
                        async: true,
                        success: function (data)
                        {

                        }
                    });

                    $( this ).parent().parent().remove();

                    return true;
                }
                else{
                    return false;
                }

            });

        });

    </script>

    <script>
        $( document ).ready(function() {

            $(document).on("click","input[type=checkbox]",function() {

                let checked = false;
                let value = $(this).val();


                if ($(this).is(':checked')) {
                    checked = true;
                    $(this).parent().addClass( "highlight" );
                }
                else {
                    checked = false;
                    $(this).parent().removeClass( "highlight" );
                }

                $.ajax({
                    url: "{{ (path('todo')) }}",
                    type: "POST",
                    dataType: "json",
                    data: {
                        "checkedAjax": checked,
                        "valAjax": value
                    },
                    async: true,
                    success: function (data)
                    {

                    }

                });

            });

        });

    </script>

{% endblock %}